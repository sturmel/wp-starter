# WordPress Starter Kit avec Docker, Timber, Webpack 5, Tailwind CSS v4 et GSAP

> **Propos√© par [Lugh Web](https://lugh-web.fr)** - Agence web sp√©cialis√©e dans le d√©veloppement WordPress moderne

Ce projet est un **kit de d√©marrage professionnel** pour d√©velopper des sites WordPress modernes et performants en utilisant Docker. Il fournit un environnement de d√©veloppement local complet, pr√©configur√© avec WordPress, MySQL, Redis, phpMyAdmin, et une cha√Æne de compilation moderne bas√©e sur **Webpack 5**.

Le syst√®me g√©n√®re automatiquement un **th√®me enfant intelligent** bas√© sur `timber-starter-theme` avec une architecture frontend compl√®te incluant **Tailwind CSS v4**, **GSAP**, **BrowserSync**, et des outils d'optimisation avanc√©s. Le th√®me suit les meilleures pratiques de d√©veloppement moderne avec une s√©paration claire entre le backend PHP/Twig et le frontend JavaScript/CSS.

## üß± Aper√ßu de la Pile Technique

| Service      | Image Docker               | Description                                |
|--------------|----------------------------|--------------------------------------------|
| wordpress    | `wordpress:php8.4-apache`  | Serveur WordPress avec PHP 8.4 et Apache   |
| db           | `mysql:8.0`                | Base de donn√©es MySQL 8.0                  |
| redis        | `redis:alpine`             | Cache d'objets Redis pour les performances |
| phpmyadmin   | `phpmyadmin/phpmyadmin`    | Interface web pour g√©rer MySQL (port 8081) |

Le conteneur WordPress utilise l'image officielle sans Dockerfile personnalis√©. Tout le r√©pertoire `/var/www/html` est mont√© en liaison (bind-mount), donc tous les fichiers WordPress (noyau, extensions, th√®mes, m√©dias) sont accessibles dans le dossier `./wordpress` sur votre machine h√¥te.

## üöÄ Fonctionnalit√©s Principales

### **üê≥ Environnement de D√©veloppement Dockeris√©**

*   **Services Complets** : WordPress, MySQL, Redis et phpMyAdmin g√©r√©s via `docker compose`
*   **Contenu Persistant** : Le dossier `./wordpress` est mapp√© pour conserver vos donn√©es entre les sessions
*   **Configuration Simple** : Toute la configuration via un fichier `.env`

### **üé® Th√®me Enfant Timber Intelligent avec Architecture Moderne**

*   **G√©n√©ration Automatique** : Cr√©ation compl√®te d'un th√®me enfant bas√© sur `timber-starter-theme`
*   **Personnalisation** : Nom du th√®me configurable via `CUSTOM_THEME_NAME`
*   **D√©pendances G√©r√©es** : 
    *   `composer.json` avec Timber install√© automatiquement
    *   `package.json` g√©n√©r√© avec toutes les d√©pendances npm modernes
    *   Installation automatique des packages lors de la premi√®re initialisation
*   **Architecture Modulaire** : 
    *   `inc/` : Modules PHP (s√©curit√©, performance)
    *   `views/` : Gabarits Twig organis√©s
    *   `assets/` : Fichiers sources CSS/JS non compil√©s
    *   `dist/` : Ressources de production optimis√©es
    *   `dev_build/` : Ressources de d√©veloppement avec cartes sources (source maps)

### **‚ö° Cha√Æne de Compilation Webpack 5 Compl√®te**

*   **Configuration Avanc√©e** : Webpack configur√© pour le d√©veloppement et la production
*   **Compilation Intelligente selon l'Environnement** : 
    *   **Mode d√©veloppement** : Compilation dans `dev_build/` avec cartes sources et rechargement automatique
    *   **Mode production** : Compilation hautement optimis√©e dans `dist/` avec minification agressive, suppression du code inutilis√© (tree-shaking) et optimisations avanc√©es
*   **Rechargement Automatique** : Compilation automatique en mode surveillance avec BrowserSync
*   **Optimisation Pouss√©e des Ressources** : 
    *   **JavaScript** : Minification avanc√©e avec `TerserPlugin` (suppression des `console.log`, code mort) et support ES6+
    *   **CSS** : Optimisation extr√™me avec `CssMinimizerPlugin` et PostCSS
    *   **√âlimination du Code Inutilis√©** : Suppression automatique du code JavaScript non utilis√© en production
    *   Nettoyage automatique des compilations pr√©c√©dentes
### **üéØ Interface Utilisateur Moderne et Optimis√©e**

*   **Tailwind CSS v4** : Framework CSS utilitaire avec la nouvelle architecture
    *   Support complet des directives `@import "tailwindcss"`
    *   Configuration `@content` pour la d√©tection automatique des classes
    *   Couches personnalisables (`@layer base`, `@layer components`, `@layer utilities`)
    *   Variables personnalis√©es avec `@theme`
    *   PostCSS int√©gr√© avec autoprefixer
*   **JavaScript ES6+ Moderne** :
    *   Support complet ES6+ avec Babel et pr√©r√©glages modernes
    *   Modules ES6 support√©s nativement
    *   GSAP inclus pour les animations fluides
    *   Regroupement intelligent avec possibilit√© de division du code
*   **Syst√®me de Gabarits Twig** :
    *   S√©paration logique entre PHP et gabarits
    *   Architecture MVC avec Timber
    *   R√©utilisabilit√© des composants
    *   S√©curit√© accrue avec √©chappement automatique

### **üîß Outils de D√©veloppement Int√©gr√©s**

*   **BrowserSync Pro** : 
    *   Synchronisation en temps r√©el sur le port 3000
    *   Injection CSS √† chaud sans rechargement de page
    *   Interface de contr√¥le avanc√©e sur le port 3001
    *   Proxy automatique vers WordPress (port configur√©)
    *   Synchronisation multi-appareils
*   **Scripts NPM Optimis√©s** :
    *   `npm run dev` : Mode d√©veloppement avec surveillance automatique et BrowserSync
    *   `npm run build` : Compilation de production avec minification compl√®te
*   **Optimisation Production Avanc√©e** :
    *   Minification JavaScript avec Terser et optimisations ES6
    *   Compression CSS optimis√©e avec suppression des doublons
    *   Suppression automatique du code inutilis√© pour r√©duire la taille des paquets
    *   Invalidation automatique du cache avec versions bas√©es sur `filemtime()`

### **üõ†Ô∏è Stack Technique Complet**

*   **Backend WordPress Optimis√©** : 
    *   WP-CLI int√©gr√© dans le conteneur pour administration
    *   Composer pour la gestion des d√©pendances PHP
    *   Timber (fourni via Composer dans le th√®me) pour l'architecture MVC
*   **Performance et Cache** :
    *   Redis pour le cache d'objets WordPress
    *   Optimisations WordPress (d√©sactivation emojis, REST API, etc.)
    *   D√©sactivation s√©lective des styles de blocs WordPress
    *   Pr√©chargement et optimisation des requ√™tes
*   **S√©curit√© Renforc√©e** :
    *   Configuration s√©curis√©e par d√©faut
    *   Suppression des en-t√™tes WordPress sensibles
    *   Protection contre l'√©dition de fichiers en production
    *   D√©sactivation XML-RPC et autres vecteurs d'attaque
    *   Extension de conformit√© RGPD pr√©install√©e : Complianz GDPR

## üìã Pr√©requis

*   [Docker](https://docs.docker.com/get-docker/)
*   [Docker Compose](https://docs.docker.com/compose/install/) (g√©n√©ralement inclus avec Docker Desktop)
*   **Node.js** (optionnel, pour le d√©veloppement frontend) - recommand√© : version 16+
*   Un navigateur moderne pour tester les fonctionnalit√©s frontend

## üöÄ D√©marrage Rapide

### √âtape 1 : Cloner le D√©p√¥t

Commencez par r√©cup√©rer le code source sur votre machine :

```bash
git clone https://github.com/sturmel/funtechadventures.com--wp.git
cd funtechadventures.com--wp
```

### √âtape 2 : Configurer les Variables d'Environnement

Cr√©ez votre fichier de configuration en copiant l'exemple fourni :

```bash
cp .env.example .env
```

Ouvrez le fichier `.env` avec votre √©diteur de texte pr√©f√©r√© et ajustez les valeurs selon vos besoins :

```bash
nano .env  # ou vim .env, ou code .env avec VS Code
```

**Configuration minimale requise :**

```bash
# Identifiants de la base de donn√©es
WORDPRESS_DB_USER=admin
WORDPRESS_DB_PASSWORD=VotreMotDePasseSecurise123
WORDPRESS_DB_NAME=wordpress_db
MYSQL_ROOT_PASSWORD=MotDePasseRootSecurise456

# Configuration de base WordPress
WORDPRESS_URL=http://localhost:8080
WORDPRESS_TITLE="Mon Site WordPress"
WORDPRESS_ADMIN_USER=admin
WORDPRESS_ADMIN_PASSWORD=AdminSecurise789
WORDPRESS_ADMIN_EMAIL=votre.email@example.com
WORDPRESS_TABLE_PREFIX=wp_
CUSTOM_THEME_NAME="Mon Th√®me Personnalis√©"

# Ports d'acc√®s (modifiez si n√©cessaire)
WORDPRESS_HOST_PORT=8080
PHPMYADMIN_HOST_PORT=8081
```

**‚ö†Ô∏è Important :** Utilisez des mots de passe forts et uniques pour chaque environnement.

### √âtape 3 : D√©marrer les Conteneurs Docker

Lancez l'infrastructure compl√®te avec une seule commande :

```bash
docker compose up -d
```

Cette commande va :
- T√©l√©charger toutes les images Docker n√©cessaires (WordPress, MySQL, Redis, phpMyAdmin)
- Cr√©er les conteneurs et les r√©seaux
- D√©marrer tous les services en arri√®re-plan
- Cr√©er automatiquement le r√©pertoire `wordpress/` et y installer WordPress

**Note :** Le premier d√©marrage peut prendre quelques minutes selon votre connexion internet.

### √âtape 4 : Installer et Configurer WordPress

Ex√©cutez le script de provisionnement automatique :

```bash
./scripts/setup-wordpress.sh
```

**Ce script effectue automatiquement les t√¢ches suivantes :**

1. ‚úÖ V√©rifie que les conteneurs Docker sont d√©marr√©s
2. ‚úÖ Attend que MySQL soit compl√®tement pr√™t
3. ‚úÖ Installe WP-CLI (outil en ligne de commande WordPress) dans le conteneur
4. ‚úÖ Installe Composer (gestionnaire de d√©pendances PHP) dans le conteneur
5. ‚úÖ G√©n√®re le fichier `wp-config.php` avec vos param√®tres du `.env`
6. ‚úÖ Installe le noyau WordPress et cr√©e votre compte administrateur
7. ‚úÖ Installe et active les extensions essentielles :
   - Advanced Custom Fields (champs personnalis√©s)
   - Rank Math SEO (r√©f√©rencement et optimisation SEO)
   - LiteSpeed Cache (performances et cache)
   - Contact Form 7 (formulaires de contact)
   - Complianz GDPR (conformit√© RGPD)
8. ‚úÖ Installe le th√®me parent Timber via Composer
9. ‚úÖ Cr√©e votre th√®me enfant personnalis√© depuis le mod√®le `scripts/custom-theme/`
10. ‚úÖ Applique les substitutions de variables (nom du th√®me, ports, etc.)
11. ‚úÖ Active automatiquement votre th√®me enfant
12. ‚úÖ Installe les d√©pendances npm (si Node.js est disponible sur votre machine)

**Le script est idempotent** : vous pouvez le relancer plusieurs fois sans probl√®me, il ne r√©-ex√©cutera que les √©tapes n√©cessaires.

### √âtape 5 : Acc√©der √† Votre Site WordPress

Une fois l'installation termin√©e, acc√©dez √† votre site via les URLs suivantes :

- **üåê Site WordPress** : `http://localhost:8080` (ou le port configur√© dans `WORDPRESS_HOST_PORT`)
- **üë§ Administration WordPress** : `http://localhost:8080/wp-admin`
  - Identifiant : celui d√©fini dans `WORDPRESS_ADMIN_USER`
  - Mot de passe : celui d√©fini dans `WORDPRESS_ADMIN_PASSWORD`
- **üóÑÔ∏è phpMyAdmin** : `http://localhost:8081`
  - Serveur : `db`
  - Utilisateur : celui d√©fini dans `WORDPRESS_DB_USER`
  - Mot de passe : celui d√©fini dans `WORDPRESS_DB_PASSWORD`

### √âtape 6 : D√©marrer le D√©veloppement Frontend (Optionnel)

Si vous souhaitez travailler sur l'apparence et les fonctionnalit√©s frontend de votre th√®me avec rechargement automatique :

```bash
# Naviguez vers le r√©pertoire de votre th√®me
cd wordpress/wp-content/themes/mon-theme-personnalise  # Remplacez par votre slug de th√®me

# Installez les d√©pendances npm (si ce n'est pas d√©j√† fait)
npm install

# D√©marrez le mode d√©veloppement avec surveillance automatique
npm run dev
```

**R√©sultat :** BrowserSync sera accessible sur `http://localhost:3000` avec rechargement automatique √† chaque modification de vos fichiers CSS, JS, PHP ou Twig.

---

**‚úÖ Votre environnement de d√©veloppement WordPress est maintenant op√©rationnel !**

## üìú Scripts de Gestion et d'Automatisation

Ce projet inclut plusieurs scripts shell pour automatiser et simplifier la gestion de votre environnement WordPress. Tous les scripts sont situ√©s dans le r√©pertoire `scripts/` et sont con√ßus pour √™tre ex√©cut√©s depuis la racine du projet.

### üöÄ `setup-wordpress.sh` - Installation Compl√®te Initiale

**Utilisation :**
```bash
./scripts/setup-wordpress.sh
```

**Description :**
Script principal d'installation et de configuration de WordPress. C'est le script √† ex√©cuter apr√®s votre premier `docker compose up -d`.

**Fonctionnalit√©s :**
- ‚úÖ V√©rifie et d√©marre les conteneurs Docker si n√©cessaire
- ‚úÖ Attend que MySQL soit compl√®tement op√©rationnel
- ‚úÖ Installe **WP-CLI** dans le conteneur WordPress
- ‚úÖ Installe **Composer** dans le conteneur WordPress
- ‚úÖ Installe **Node.js 22.x LTS** dans le conteneur WordPress
- ‚úÖ Configure les plugins autoris√©s pour Composer
- ‚úÖ G√©n√®re `wp-config.php` avec les param√®tres du `.env`
- ‚úÖ Ajoute la configuration Redis pour LiteSpeed Cache
- ‚úÖ Installe le noyau WordPress
- ‚úÖ Cr√©e le compte administrateur
- ‚úÖ Installe et active les plugins essentiels :
  - Advanced Custom Fields (ACF)
  - Rank Math SEO
  - LiteSpeed Cache
  - Contact Form 7
  - Complianz GDPR
- ‚úÖ Installe le th√®me parent `timber-starter-theme` via Composer
- ‚úÖ Cr√©e votre th√®me enfant personnalis√© depuis le template
- ‚úÖ Applique les substitutions de variables (`{{CUSTOM_THEME_SLUG}}`, etc.)
- ‚úÖ Active automatiquement votre th√®me personnalis√©
- ‚úÖ Installe le drop-in `object-cache.php` pour Redis
- ‚úÖ Installe les d√©pendances npm du th√®me dans le conteneur

**Caract√©ristiques :**
- **Idempotent** : Peut √™tre relanc√© sans risque, ne refait que ce qui est n√©cessaire
- **Autonome** : Installe tous les outils requis (WP-CLI, Composer, Node.js) dans le conteneur
- **S√©curis√©** : V√©rifie les variables d'environnement requises avant de commencer

**Quand l'utiliser :**
- Premi√®re installation apr√®s `docker compose up -d`
- Apr√®s avoir supprim√© le dossier `wordpress/`
- Pour r√©initialiser compl√®tement WordPress (avec `docker compose down -v` avant)

---

### üîÑ `migrate.sh` - Migration et Mise √† Jour

**Utilisation :**
```bash
./scripts/migrate.sh
```

**Description :**
Script de migration non-destructif pour mettre √† jour la configuration et les d√©pendances sans perdre de donn√©es.

**Fonctionnalit√©s :**
- ‚úÖ R√©g√©n√®re `wp-config.php` √† partir du `.env` (cl√©s de s√©curit√© fra√Æches)
- ‚úÖ D√©marre les conteneurs Docker (`docker compose up -d`)
- ‚úÖ Attend que MySQL et WordPress soient pr√™ts
- ‚úÖ Installe Composer dans le conteneur s'il est manquant
- ‚úÖ Installe Node.js 22.x LTS dans le conteneur s'il est manquant
- ‚úÖ Ex√©cute `composer install` dans `timber-starter-theme/`
- ‚úÖ Ex√©cute `npm install` dans votre th√®me personnalis√©

**Caract√©ristiques :**
- **Non-destructif** : AUCUNE suppression de donn√©es, conteneurs ou volumes
- **Intelligent** : D√©tecte et installe uniquement ce qui manque
- **Rapide** : Id√©al pour les mises √† jour de d√©pendances

**Quand l'utiliser :**
- Apr√®s avoir modifi√© votre `.env` (pour r√©g√©n√©rer `wp-config.php`)
- Apr√®s `docker compose down -v` (pour r√©installer Composer/Node.js)
- Pour mettre √† jour les d√©pendances npm ou Composer
- Apr√®s avoir clon√© le projet sur une nouvelle machine
- Pour s'assurer que l'environnement est √† jour

**Diff√©rence avec `setup-wordpress.sh` :**
- ‚ùå Ne touche PAS √† WordPress (pas de r√©installation)
- ‚ùå Ne touche PAS aux plugins
- ‚ùå Ne touche PAS aux th√®mes
- ‚úÖ Focus uniquement sur la configuration et les d√©pendances

---

### ‚öôÔ∏è `generate-wp-config.sh` - G√©n√©rateur de Configuration WordPress

**Utilisation :**
```bash
./scripts/generate-wp-config.sh
```

**Description :**
G√©n√®re ou r√©g√©n√®re le fichier `wordpress/wp-config.php` en se basant uniquement sur les variables du fichier `.env`.

**Fonctionnalit√©s :**
- ‚úÖ Lit les variables depuis `.env`
- ‚úÖ G√©n√®re des cl√©s de s√©curit√© WordPress fra√Æches depuis l'API officielle
- ‚úÖ Cr√©e un fichier `wp-config.php` complet et s√©curis√©
- ‚úÖ Configure la connexion √† la base de donn√©es
- ‚úÖ Ajoute la configuration Redis si `REDIS_ENABLED=true`
- ‚úÖ Ajoute la configuration multisite si `WP_MULTISITE=true`
- ‚úÖ D√©finit les permissions appropri√©es (644)

**Variables utilis√©es depuis `.env` :**
```bash
WORDPRESS_DB_NAME          # Nom de la base de donn√©es
WORDPRESS_DB_USER          # Utilisateur MySQL
WORDPRESS_DB_PASSWORD      # Mot de passe MySQL
WORDPRESS_TABLE_PREFIX     # Pr√©fixe des tables (d√©faut: wp_)
REDIS_ENABLED             # Optionnel: active Redis
WP_MULTISITE              # Optionnel: active le multisite
WP_SUBDOMAIN_INSTALL      # Optionnel: multisite par sous-domaines
DOMAIN_CURRENT_SITE       # Optionnel: domaine principal du multisite
```

**Quand l'utiliser :**
- Apr√®s avoir modifi√© les identifiants de base de donn√©es dans `.env`
- Pour r√©g√©n√©rer les cl√©s de s√©curit√© WordPress
- Si `wp-config.php` a √©t√© corrompu ou supprim√©
- Pour activer/d√©sactiver Redis ou le multisite

**Note :**
Ce script est automatiquement appel√© par `migrate.sh`, mais peut aussi √™tre utilis√© de mani√®re ind√©pendante.

---

### üß™ `test-redis.sh` - Test de Configuration Redis

**Utilisation :**
```bash
./scripts/test-redis.sh
```

**Description :**
Script de diagnostic complet pour v√©rifier que Redis est correctement configur√© et op√©rationnel avec LiteSpeed Cache.

**Tests effectu√©s :**
1. ‚úÖ **Conteneur Redis** - V√©rifie que le conteneur Redis est d√©marr√©
2. ‚úÖ **Extension PHP Redis** - V√©rifie que l'extension PHP Redis est install√©e et affiche la version
3. ‚úÖ **Connexion Redis** - Test de lecture/√©criture pour valider la connexion
4. ‚úÖ **Drop-in object-cache.php** - V√©rifie la pr√©sence du fichier
5. ‚úÖ **Configuration wp-config.php** - V√©rifie que les constantes Redis sont d√©finies
6. ‚úÖ **Informations Redis** - Affiche la version et les statistiques du serveur Redis

**Sortie exemple :**
```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  Test de configuration Redis
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. V√©rification du conteneur Redis... ‚úì
2. V√©rification de l'extension PHP Redis... ‚úì
   Version: 6.2.0
3. Test de connexion √† Redis... ‚úì
4. V√©rification du drop-in object-cache.php... ‚úì
5. V√©rification de wp-config.php... ‚úì
   Configuration Redis trouv√©e dans wp-config.php

6. Informations Redis:
   redis_version:8.2.2
   os:Linux 6.12.5-linuxkit x86_64
   uptime_in_seconds:423

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  Tests termin√©s avec succ√®s !
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

**Quand l'utiliser :**
- Apr√®s l'installation pour v√©rifier que Redis fonctionne
- Avant d'activer Object Cache dans LiteSpeed Cache
- En cas de probl√®me de performance ou de cache
- Pour diagnostiquer des erreurs li√©es √† Redis

**Documentation associ√©e :**
Consultez `/docs/REDIS_SETUP.md` pour le guide complet de configuration Redis avec LiteSpeed Cache.

---

### üìã R√©sum√© des Scripts

| Script | Utilisation | Destructif ? | Quand l'utiliser |
|--------|-------------|--------------|------------------|
| **setup-wordpress.sh** | Installation compl√®te | ‚ö†Ô∏è Oui (si WordPress existe) | Premi√®re installation |
| **migrate.sh** | Mise √† jour config + deps | ‚ùå Non | Apr√®s modifications du .env |
| **generate-wp-config.sh** | G√©n√©rer wp-config.php | ‚ö†Ô∏è √âcrase wp-config.php | Changement de config DB |
| **test-redis.sh** | Tester Redis | ‚ùå Non | Diagnostic Redis |

### üí° Workflows Recommand√©s

**Premier d√©marrage du projet :**
```bash
cp .env.example .env          # Configurer vos variables
nano .env                      # Personnaliser
docker compose up -d          # D√©marrer les conteneurs
./scripts/setup-wordpress.sh  # Installation compl√®te
./scripts/test-redis.sh       # V√©rifier Redis
```

**Apr√®s un `docker compose down -v` :**
```bash
docker compose up -d          # Red√©marrer avec volumes vides
./scripts/migrate.sh          # R√©g√©n√©rer config + r√©installer d√©pendances
```

**Mise √† jour des d√©pendances uniquement :**
```bash
./scripts/migrate.sh          # Met √† jour Composer et npm
```

**Changement de configuration base de donn√©es :**
```bash
nano .env                            # Modifier WORDPRESS_DB_*
./scripts/generate-wp-config.sh     # R√©g√©n√©rer wp-config.php
docker compose restart wordpress    # Red√©marrer WordPress
```

---

## üìÇ Structure du D√©p√¥t

```
.
‚îú‚îÄ‚îÄ docker-compose.yml          # D√©finit WordPress, MySQL, Redis, phpMyAdmin
‚îú‚îÄ‚îÄ Dockerfile                  # Image WordPress personnalis√©e avec Redis
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ setup-wordpress.sh      # Script d'installation compl√®te
‚îÇ   ‚îú‚îÄ‚îÄ migrate.sh             # Script de migration non-destructif
‚îÇ   ‚îú‚îÄ‚îÄ generate-wp-config.sh   # G√©n√©rateur de wp-config.php
‚îÇ   ‚îú‚îÄ‚îÄ test-redis.sh          # Script de diagnostic Redis
‚îÇ   ‚îî‚îÄ‚îÄ custom-theme/           # Template du th√®me Timber copi√© par les scripts
‚îÇ       ‚îú‚îÄ‚îÄ style.css
‚îÇ       ‚îú‚îÄ‚îÄ functions.php
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îú‚îÄ‚îÄ webpack.config.js
‚îÇ       ‚îú‚îÄ‚îÄ postcss.config.js
‚îÇ       ‚îú‚îÄ‚îÄ browsersync.config.js
‚îÇ       ‚îú‚îÄ‚îÄ tailwind.config.js
‚îÇ       ‚îú‚îÄ‚îÄ .gitignore
‚îÇ       ‚îú‚îÄ‚îÄ assets/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles.css
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ scripts.js
‚îÇ       ‚îî‚îÄ‚îÄ inc/
‚îÇ           ‚îú‚îÄ‚îÄ performance.php
‚îÇ           ‚îî‚îÄ‚îÄ security.php
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ object-cache.php       # Drop-in Redis pour LiteSpeed Cache
‚îú‚îÄ‚îÄ wordpress/                  # Installation compl√®te WordPress (core + wp-content)
‚îÇ   ‚îî‚îÄ‚îÄ wp-content/
‚îÇ       ‚îú‚îÄ‚îÄ themes/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ timber-starter-theme/  # Th√®me parent (auto-install√©)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ {custom-slug}/         # Votre th√®me enfant (auto-cr√©√©)
‚îÇ       ‚îú‚îÄ‚îÄ plugins/            # Plugins install√©s automatiquement
‚îÇ       ‚îî‚îÄ‚îÄ uploads/            # Fichiers m√©dias
‚îú‚îÄ‚îÄ .env.example                # Template des variables d'environnement
‚îî‚îÄ‚îÄ README.md                   # Cette documentation
```

## ‚úÖ D√©pannage

### Probl√®mes Courants

**Le script signale des erreurs `command not found` lors du sourcing de `.env`**
- Assurez-vous que toute valeur contenant des espaces est entre guillemets.

**√âchec de `npm install` pour le th√®me custom**
- Les scripts `setup-wordpress.sh` et `migrate.sh` installent automatiquement Node.js 22.x LTS dans le conteneur WordPress si n√©cessaire.

**Les conteneurs ne d√©marrent pas**
- V√©rifiez que les identifiants de la base de donn√©es dans `.env` correspondent √† la fois aux variables d'environnement WordPress et MySQL.

**Redis ne s'active pas dans LiteSpeed Cache**
- Utilisez `./scripts/test-redis.sh` pour diagnostiquer les probl√®mes Redis.
- Le script v√©rifie l'extension PHP, la connexion, et le drop-in `object-cache.php`.

**Pour repartir de z√©ro**
    *   `production` : Mode production avec assets optimis√©s, s√©curit√© renforc√©e
*   `WORDPRESS_SHOW_WARNINGS` : 
    *   `true` : Affiche les avertissements PHP pour le d√©bogage
    *   `false` : Masque les avertissements pour une interface propre (recommand√©)

### **Configuration Docker**
*   `WORDPRESS_HOST_PORT` : Port sur la machine h√¥te (ex: `8080`)

### **Configuration Redis** (Cache d'objets)
*   `WORDPRESS_REDIS_HOST` : H√¥te Redis (par d√©faut `redis`)
*   `WORDPRESS_REDIS_PORT` : Port Redis (par d√©faut `6379`)

### **Configuration SMTP** (Emails via msmtp)
*   `MSMTP_HOST` : Serveur SMTP (ex: `sandbox.smtp.mailtrap.io`)
*   `MSMTP_PORT` : Port SMTP (ex: `587`)
*   `MSMTP_FROM` : Adresse email d'exp√©dition
*   `MSMTP_AUTH` : Authentification (`on` ou `off`)
*   `MSMTP_USER` : Nom d'utilisateur SMTP
*   `MSMTP_PASSWORD` : Mot de passe SMTP
*   `MSMTP_TLS` : Utiliser TLS (`on` ou `off`)
*   `MSMTP_TLS_STARTTLS` : Utiliser STARTTLS (`on` ou `off`)
*   `MSMTP_LOGFILE` : Fichier de log msmtp (ex: `/tmp/msmtp.log`)

## üõ†Ô∏è Guide de D√©veloppement

### **Acc√©der au Conteneur WordPress**

```bash
# Acc√©der au shell du conteneur
docker compose exec wordpress bash

# V√©rifier l'environnement Node.js
node --version  # Devrait afficher v22.10.0
npm --version   # Devrait afficher la version npm correspondante
```

### **üîß D√©veloppement Frontend avec Webpack**

> ‚ö†Ô∏è **Important** : Les commandes `npm run dev` et `npm run build` doivent √™tre ex√©cut√©es sur votre **machine h√¥te**, pas dans les conteneurs Docker, pour des raisons de performance et de compatibilit√© avec BrowserSync.

#### **Architecture des Assets**

Le syst√®me de build Webpack est configur√© pour g√©rer intelligemment les environnements :

```bash
# Naviguer vers votre th√®me (sur votre machine h√¥te)
cd wp-content/themes/[CUSTOM_THEME_NAME]

# Structure des assets
assets/css/styles.css        # Source Tailwind CSS v4
assets/js/scripts.js         # Source JavaScript ES6+
dev_build/                   # Build de d√©veloppement (non minifi√©)
dist/                        # Build de production (optimis√©)
```

#### **Scripts NPM Disponibles**

```bash
# Mode d√©veloppement avec watch + BrowserSync (sur l'h√¥te)
npm run dev
# - Compilation automatique en mode watch
# - BrowserSync sur localhost:3000
# - Source maps activ√©es
# - Assets dans dev_build/

# Build de production (sur l'h√¥te)
npm run build  
# - Minification avec Terser
# - Optimisation CSS
# - Assets dans dist/
# - Cache busting automatique
```

#### **Configuration Tailwind CSS v4**

Le fichier `assets/css/styles.css` utilise la nouvelle syntaxe Tailwind v4 :

```css
/* Import Tailwind's base, components, and utilities for v4 */
@import "tailwindcss";

/* Explicitly define content paths for Tailwind v4 */
@content '../../views/**/*.twig';
@content '../../*.php';
@content '../js/**/*.js';

/* Custom layers */
@layer base {
  /* Vos styles de base */
}

@layer components {
  /* Vos composants r√©utilisables */
}

@layer utilities {
  /* Vos utilitaires personnalis√©s */
}

/* Custom theme variables for Tailwind v4 */
@theme {
  /* Variables CSS personnalis√©es */
}
```

#### **JavaScript Moderne avec ES6+**

Le fichier `assets/js/scripts.js` supporte les modules ES6 et les imports :

```javascript
import { gsap } from 'gsap';

// Votre code JavaScript moderne
addEventListener('DOMContentLoaded', function() {
   console.log('üîß Webpack entry file loaded');
   
   // Utilisation de GSAP
   gsap.from('.my-element', {duration: 2, y: 50, opacity: 0});
});
```

```bash
docker compose down -v
rm -rf wordpress/
cp .env.example .env  # Reconfigurez vos variables
docker compose up -d
./scripts/setup-wordpress.sh
```

## üìú Scripts Disponibles

### Script Principal : `setup-wordpress.sh`

Le script de provisionnement principal qui configure l'ensemble de l'environnement.

```bash
./scripts/setup-wordpress.sh
```

**Ce qu'il fait :**
- D√©marre les conteneurs si n√©cessaire
- Attend que MySQL soit pr√™t
- Installe WP-CLI et Composer dans le conteneur
- Cr√©e `wp-config.php` avec les bonnes valeurs
- Installe le noyau WordPress
- Installe et active les extensions par d√©faut (ACF, Rank Math SEO, LiteSpeed Cache, Contact Form 7, Complianz GDPR)
- Installe le th√®me starter Timber via Composer
- Copie et configure votre th√®me personnalis√© depuis `scripts/custom-theme/`
- Ex√©cute `npm install` si Node.js est disponible sur l'h√¥te

### Script Alternatif : `generate-wp-config.sh`

G√©n√©rateur alternatif de `wp-config.php` si vous pr√©f√©rez ne pas utiliser WP-CLI.

```bash
./scripts/generate-wp-config.sh
```

## üé® D√©veloppement du Th√®me

### Structure du Th√®me Personnalis√©

Le mod√®le du th√®me se trouve dans `scripts/custom-theme/` et sera copi√© vers `wordpress/wp-content/themes/{votre-slug}/` lors de l'ex√©cution du script de configuration.

**Fichiers inclus dans le template :**

```
scripts/custom-theme/
‚îú‚îÄ‚îÄ style.css                # En-t√™te du th√®me WordPress
‚îú‚îÄ‚îÄ functions.php            # Enqueue des assets et configuration
‚îú‚îÄ‚îÄ .gitignore              # Exclusions Git
‚îú‚îÄ‚îÄ package.json            # D√©pendances npm et scripts
‚îú‚îÄ‚îÄ webpack.config.js       # Configuration Webpack
‚îú‚îÄ‚îÄ postcss.config.js       # Configuration PostCSS + Tailwind
‚îú‚îÄ‚îÄ browsersync.config.js   # Configuration BrowserSync
‚îú‚îÄ‚îÄ tailwind.config.js      # Configuration Tailwind CSS
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles.css      # CSS source avec Tailwind v4
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ scripts.js      # JavaScript ES6+ source
‚îî‚îÄ‚îÄ inc/
    ‚îú‚îÄ‚îÄ performance.php     # Optimisations WordPress
    ‚îî‚îÄ‚îÄ security.php        # S√©curisations WordPress
```

### Scripts NPM du Th√®me

Une fois dans le r√©pertoire du th√®me (`wordpress/wp-content/themes/{votre-slug}/`) :

```bash
# Installation des d√©pendances
npm install

# Mode d√©veloppement avec watch et BrowserSync
npm run dev

# Build de production optimis√©
npm run build
```

### Substitution de Variables

Le script remplace automatiquement ces placeholders dans les fichiers du template :

- `{{CUSTOM_THEME_SLUG}}` ‚Üí Votre slug de th√®me (depuis `.env`)
- `{{STARTER_THEME_SLUG}}` ‚Üí `timber-starter-theme`
- `{{WORDPRESS_HOST_PORT}}` ‚Üí Port configur√© (d√©faut `8080`)

## üìä Commandes Docker Utiles

```bash
# D√©marrer les services
docker compose up -d

# Arr√™ter les services
docker compose down

# Arr√™ter et supprimer les volumes (ATTENTION : perte de donn√©es)
docker compose down -v

# Voir les logs
docker compose logs -f wordpress
docker compose logs -f db

# Red√©marrer un service
docker compose restart wordpress

# Entrer dans un conteneur
docker compose exec wordpress bash
docker compose exec db mysql -u root -p

# Voir l'√©tat des conteneurs
docker compose ps
```

## üîß Personnalisation Avanc√©e

### Ajouter des Plugins par D√©faut

√âditez `scripts/setup-wordpress.sh` et ajoutez vos plugins √† la liste :

```bash
install_plugins() {
  local plugins=(
    advanced-custom-fields
    seo-by-rank-math
    litespeed-cache
    contact-form-7
    complianz-gdpr
    # Ajoutez vos plugins ici
    mon-plugin-favori
  )
  # ...
}
```

### Modifier le Template du Th√®me

Les fichiers dans `scripts/custom-theme/` sont copi√©s √† chaque ex√©cution du script. Vous pouvez :

1. Modifier les fichiers dans `scripts/custom-theme/`
2. Relancer `./scripts/setup-wordpress.sh`
3. Les variables seront re-substitu√©es (vos modifications dans le th√®me g√©n√©r√© seront √©cras√©es)

**Astuce :** Une fois le th√®me g√©n√©r√©, travaillez directement dans `wordpress/wp-content/themes/{votre-slug}/` pour vos d√©veloppements quotidiens.

## üåê Configuration de Production

Pour un d√©ploiement en production, ajustez ces variables dans votre `.env` :

```bash
# Mode production
WORDPRESS_ENV=production

# D√©sactiver le debug
WP_DEBUG=false

# S√©curit√© renforc√©e
DISALLOW_FILE_EDIT=true

# Cache Redis
REDIS_ENABLED=true
```

Puis buildez les assets en mode production :

```bash
cd wordpress/wp-content/themes/{votre-slug}
npm run build
```

## üìö Ressources et Documentation

### WordPress & Timber

- [Documentation WordPress](https://developer.wordpress.org/)
- [Timber Documentation](https://timber.github.io/docs/)
- [Twig Documentation](https://twig.symfony.com/)
- [WP-CLI Commands](https://developer.wordpress.org/cli/commands/)

### Outils Frontend

- [Tailwind CSS v4](https://tailwindcss.com/)
- [Documentation Webpack](https://webpack.js.org/)
- [BrowserSync](https://browsersync.io/)
- [GSAP](https://gsap.com/)

### Docker

- [Documentation Docker](https://docs.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)

## üìÑ Licence

Ce projet est sous licence MIT. Voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

---

## üôè Cr√©dits

**D√©velopp√© et maintenu par [Lugh Web](https://lugh-web.fr)**

Lugh Web est une agence web sp√©cialis√©e dans le d√©veloppement WordPress moderne et performant. Nous cr√©ons des solutions web sur mesure en utilisant les derni√®res technologies et les meilleures pratiques du d√©veloppement.

### üåê Nous Contacter

- **Site web** : [https://lugh-web.fr](https://lugh-web.fr)
- **Email** : contact@lugh-web.fr
- **GitHub** : [@lugh-web](https://github.com/sturmel)

### üíº Nos Services

- D√©veloppement WordPress sur mesure
- Cr√©ation de th√®mes personnalis√©s
- Optimisation des performances
- H√©bergement et maintenance
- Conseil technique

---

**Fait avec ‚ù§Ô∏è par Lugh Web** | *Happy coding! üéâ*

